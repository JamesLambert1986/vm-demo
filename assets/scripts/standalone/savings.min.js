var newReward, oldReward = document.querySelectorAll("[data-min-value]")[0]; function postbackform() { $("#existingRatesPage").submit() } function CalculateSavingsMiles() { var e, t = document.querySelectorAll("[data-min-value]")[0], a = !0, n = $("#monthly_spend").val(), i = $("#aer_rate").val(); if (/(?=.)^\$?(([1-9][0-9]{0,2}(,[0-9]{3})*)|[0-9]+)?(\.[0-9]{1,2})?$/.test(n) ? n = n.replace(/,/g, "") : ($("#vaaCalcError").text("Please enter a valid amount between £1 and £1,000,000").removeClass("visually-hidden"), $("#monthly_spend").addClass("error--field"), a = !1), ((n = parseFloat(n)) < 1 || 1e6 < n) && ($("#vaaCalcError").text("Please enter a valid amount between  £" + v(1) + " and £" + v(1e6)).removeClass("visually-hidden"), $("#monthly_spend").addClass("error--field"), a = !1), a) { $("#vaaCalcError").addClass("visually-hidden"), $("#monthly_spend").removeClass("error--field"), n % 1 != 0 && (n = parseFloat(n).toFixed(2)); var s, o = document.querySelectorAll("[data-min-value]"); s = n; var l = !1; for (var r in o) if (o.hasOwnProperty(r) && o[r] != t) { var c = parseInt(o[r].getAttribute("data-min-value")), d = parseInt(o[r].getAttribute("data-max-value")); c <= s && s <= d && (e = o[r], l = !0) } l && ($(t).fadeOut(500, function () { $(e).fadeIn(500) }), t = e), $(".miles-calc-results > p").eq(0).fadeOut(500, function () { $("#miles").removeClass("d-none"), $("#annualMilesAmt").text(v(s)), $("#monthMilesAmt").text(v(n)), $(this).fadeIn(500) }); document.querySelectorAll("[data-miles-multiplier]"), parseFloat(i / 100).toFixed(4); var u = 0; u = Math.floor(s * i / 100 / .0085 + 1e-10); 1e3 == s && ($("#miles-result-2").html(annualMiles).fadeIn(500), $("#miles-result-3").html(u).fadeIn(500)); u = v(u); $("#miles-result-1").fadeOut(500, function () { $("#monthMilesAmt, #monthMilesAmt1").html(v(n)).fadeIn(500), $("#miles-result-1").html(u).fadeIn(500) }) } function v(e) { x = (e += "").split("."), x1 = x[0], x2 = 1 < x.length ? "." + x[1] : ""; for (var t = /(\d+)(\d{3})/; t.test(x1);)x1 = x1.replace(t, "$1,$2"); return x1 + x2 } } function getCategories() { $("#SubcategoryContainer").addClass("d-none"), $("#ProductsContainer").html(""), $("#HistoricalAccountPrevious").val("true" != $("#HistoricalAccountPrevious").val().toLowerCase()), $.ajax({ type: "POST", url: "/savings/Existing/AjaxGetHistoricalCategories", data: { IsHistorical: $("input:radio[name='HistoricalAccount']:checked").val() }, success: function (e) { $("#SelectedCategory").html(updateDropdown(e, "-- Please select --")) } }) } function onCategoryChange() { "true" == $("input:radio[name='HistoricalAccount']:checked").val().toLowerCase() ? ($("#ProductsContainer").html(""), "" === $("#SelectedCategory").val() ? $("#SubcategoryContainer").addClass("d-none") : getSubCategories()) : getProducts() } function getSubCategories() { $.ajax({ type: "POST", url: "/savings/Existing/AjaxGetHistoricalSubCategories", data: { CategoryId: $("#SelectedCategory").val() }, success: function (e) { $("#SelectedSubCategory").html(updateDropdown(e, "-- Please select --")), $("#SubcategoryContainer").removeClass("d-none") } }) } function getProducts() { if (0 < $(".pods #RateCriteria").length) return $("#RateCriteria").off("submit.historical"), "False" == $("input:radio[name='HistoricalAccount']:checked").val() ? void ($("#SelectedCategory").val() && "" !== $("#SelectedCategory").val() && $("#RateCriteria").submit()) : void ($("#SelectedSubcategory").val() && "" !== $("#SelectedSubcategory").val() && $("#RateCriteria").submit()); "" !== $("#SelectedCategory").val() ? $.ajax({ type: "POST", dataType: "html", url: "/savings/Existing/AjaxGetProducts", data: $("#RateCriteria").serialize(), success: function (e) { $("#ProductsContainer").html(e), hideJSToggles(), $("#ProductsContainer .js-hidden-content").addClass("is-hidden"), $("#ProductsContainer .js-show-content").on("click", function (e) { e.preventDefault(), $(this).hasClass("is-active") ? ($(this).parent().parent().next(".js-hidden-content").addClass("is-hidden"), $(this).removeClass("is-active"), $(this).text($(this).attr("data-text-original"))) : ($(this).parent().parent().next(".js-hidden-content").removeClass("is-hidden"), $(this).addClass("is-active"), $(this).text($(this).attr("data-text-replace"))) }) } }) : $("#ProductsContainer").html("") } function updateDropdown(e, t) { var a = ""; for (t && (a += '<option value="">' + t + "</option>"), i = 0; i < e.length; i++)a += '<option value="' + e[i].ID + '">' + e[i].Txt + "</option>"; return a } function FASupdate(t) { filters = $("#FAS").serialize(), t ? $("#FAS_results ." + t).length || $("#FAS_results").append('<div class="' + t + '"></div>') : (t = $(".tab__target:not(.collapsed)").attr("href").split("/").slice(-1)[0].replace("#", ""), $("#FAS_results").html("").append('<div class="' + t + '"></div>')), filters += "&openingMethod=" + t, $.ajax({ type: "POST", dataType: "html", url: "/savings/FAS/AjaxUpdateResults", data: filters, success: function (e) { $("#totalProducts").remove(), $("#FAS_results").html(e), _gaq.push(["_trackEvent", "Internal Link", "Click", "FAS - Filters"]), $("#" + t).addClass("show"), $("#FAS_results li.tab a").addClass("collapsed"), $("[href='#" + t + "'").removeClass("collapsed"), $("#myResults").text($("#totalProducts").data("totalcount")) } }) } function savCalc() { var n; savingsAmount(n = 2e4), 0 < $(".calcIsa").length && (0 < $(".opening-amount").val() || $(".opening-amount").hasClass("error--field") || "checked" == $("#calcIsaYesCurr").attr("checked") || $(".opening-amount").val(1e4), $(".slider__opening-amount").slider({ value: $("#opening-amount").val(), animate: !0, min: 0, max: n, step: 10, range: "min", slide: function (e, t) { $("#opening-amount").val(t.value); var a = $("#opening-amount").val(); canSave = (n - a) / 12, canSave < 0 && (canSave = 0), $("#saving-allowance").html("&pound;" + canSave.toFixed(2)), $(".slider__monthly-saving").slider("option", "max", canSave), $(".slider__monthly-saving").slider("value", $(".slider__monthly-saving").slider("value")), $("#monthly-saving").val() > canSave && $("#monthly-saving").val(canSave.toFixed(0)) } }), $("#opening-amount").on("keyup", function () { $(".slider__opening-amount").slider("value", this.value); var e = $("#opening-amount").val(); canSave = (n - e) / 12, canSave < 0 && (canSave = 0), $("#saving-allowance").html("&pound;" + canSave.toFixed(2)), $(".slider__monthly-saving").slider("option", "max", canSave), $(".slider__monthly-saving").slider("value", $(".slider__monthly-saving").slider("value")), $("#monthly-saving").val() > canSave && $("#monthly-saving").val(canSave.toFixed(0)) }), openingAmount = $("#opening-amount").val(), canSave = (n - openingAmount) / 12, canSave < 0 && (canSave = 0), $("#saving-allowance").html("&pound;" + canSave.toFixed(2)), $(".slider__monthly-saving").slider({ value: $("#monthly-saving").val(), animate: !0, min: 0, max: canSave, step: 1, range: "min", slide: function (e, t) { $("#monthly-saving").val(t.value); var a = $("#opening-amount").val(); canSave = (n - a) / 12, canSave < 0 && (canSave = 0) } }), $("#monthly-saving").on("keyup", function () { $(".slider__monthly-saving").slider("value", this.value) }), "checked" == $("#calcIsaNoCurr").attr("checked") && ($("div.active").removeClass("active"), $("#calcIsaNoCurr").closest(".tabbed-radio__container").addClass("active"), $(".open-account").show(), $(".transfer-account").hide()), "checked" == $("#calcIsaYesCurr").attr("checked") && ($("div.active").removeClass("active"), $("#calcIsaYesCurr").closest(".tabbed-radio__container").addClass("active"), $(".transfer-account").show(), $(".open-account").hide()), $("#calcIsaNoCurr").on("click", function () { $("#opening-amount").val(1e4), $("#transfer-amount").val(""), $("#additional").val(""), $("#monthly-saving").val(""), $("input").removeClass("error--field"), $(".error--message").hide() }), $("#calcIsaYesCurr").on("click", function () { $("#opening-amount").val(""), $("#monthly-saving").val(""), $("input").removeClass("error--field"), $(".error--message").hide() })), radioShowHides(), hideJSToggles(), $("#calcForm").find("input[type=submit]").off().on().click(function (e) { e.preventDefault(), getCalcErrors() }) } function savingsAmount(e) { var t = (e - $("#opening-amount").val()) / 12; t < 0 && (t = 0), $("#saving-allowance").html("&pound;" + t.toFixed(2)) } function getCalcErrors() { var a = "#calcForm", e = "/savings/find/ajaxaccountcalculatorinputform/" + $(a).find("#productId").val() + "?_=" + (new Date).getTime(); $.ajax({ type: "POST", url: e, data: $("#calcForm").serialize(), success: function (e) { $(a).replaceWith(e), savCalc(); var t = $(a).find(".error--field").length; getCalcResults(a, t) }, dataType: "html" }) } function getCalcResults(e, t, a, n) { var i = $(e).find("#productId").val(), s = new Date, o = n ? "/savings/find/ajaxaccountcalculatorclearresults/" + i + "?_=" + s.getTime() : "/savings/find/ajaxaccountcalculatorresults/" + i + "?_=" + s.getTime(); if ("0" == t) { $(".spinner").show().delay(1e3).fadeOut(), setTimeout(function () { $.ajax({ type: "POST", url: o, data: $("#calcForm").serialize(), success: function (e) { $(document).find(".calculations").replaceWith(e), savCalc(), $(".calculations").show() }, dataType: "html" }) }, 1400) } else savCalc() } function radioShowHides() { $(".radio__trigger").on("click", function () { var e = $("." + $(this).data("rel")), t = $(this).parent().siblings().find(".radio__trigger"); $("." + t.data("rel")).hide(), e.siblings(".radio__content").hide(), 0 < $("#appointment").length && $(".radio__content").hide(), e.show() }), $(".radio__trigger-child").on("click", function () { $(".radio__content-child").hide(), $("." + $(this).data("rel")).show() }), $(".tabbed-radio__input").on("change", function () { $("div.active").removeClass("active"), $(this).closest(".tabbed-radio__container").addClass("active") }), $(".radio-button").on("click", function () { "Yes" === $(this).val() ? $(".yes-content").show() : $(".yes-content").hide() }) } function hideJSToggles() { $(".js-hidden").hide(), $(".js-shown").removeClass("js-shown") } function changeHref(e, t, a) { $("#existingcustomer").is(":checked") ? $("#productfamilyapplynow").attr("href", "/_ets2/securegateway.asp?Product=" + e + "&CustomerType=APPLY&ID=" + t + a) : $("#productfamilyapplynow").attr("href", "/_ets2/securegateway.asp?Product=" + e + "&CustomerType=SIGNIN&ID=" + t + a) } function loadTab(e) { $("#FAS_results ." + e).length ? toggleOpeningTab(e) : FASupdate(e) } function toggleOpeningTab(e) { $("#FAS_results").children().hide(), $("#FAS_results ." + e).show(), $("#" + e + "-products-tab").addClass("tab-active").attr("aria-selected", "true").siblings().removeClass("tab-active").attr("aria-selected", "false"), $("#" + e + "-products-tab a").focus() } function RowCompareAsc(e, t) { var a = e.value, n = t.value; return a == n ? 0 : n < a ? 1 : -1 } function RowCompareDsc(e, t) { var a = e.value, n = t.value; return a == n ? 0 : a < n ? 1 : -1 } function setSort(e, t) { return "" == e.attr("sort") ? (e.attr("sort", "asc"), "asc") : "asc" == e.attr("sort") ? (e.attr("sort", "desc"), "desc") : (e.attr("sort", "asc"), "asc") } jQuery.fn.extend({ live: function (e, t) { this.selector && jQuery(document).on(e, this.selector, t) } }), $(".js-toggle-displaycontent").live("click", function (e) { e.preventDefault(), e.stopPropagation(), $(this).hasClass("is-active") ? ($(this).next().addClass("is-hidden"), $(this).removeClass("is-active"), $(this).text($(this).attr("data-text-original"))) : ($(this).next().removeClass("is-hidden"), $(this).addClass("is-active"), $(this).text($(this).attr("data-text-replace"))) }), $(".fas-tab-change .tab-links-change a").live("click", function (e) { e.preventDefault(); var t = $(this).attr("href"); if (!$(this).parent().hasClass("tab-active")) { var a = t.split("/").slice(-1)[0]; loadTab(a), history.pushState({ openingMethod: a }, null, "/savings/find/results/" + a), _gaq.push(["_trackEvent", "Internal Link", "Click", "FAS – " + a]) } }), window.addEventListener("popstate", function (e) { e.state && loadTab(e.state.openingMethod) }), $(".fasrates").live("click", function (e) { for (var t = setSort($("#act-rate-sort"), "asc"), a = $(this).closest("table"), n = a.children("tbody"), i = a.find("tbody>tr"), s = new Array, o = 0, l = i.length; o < l; o++)s[o] = new Object, s[o].oldIndex = o, s[o].value = i[o].getElementsByTagName("td")[1].getAttribute("data"); "asc" == t ? s.sort(RowCompareAsc) : s.sort(RowCompareDsc); var r = document.createElement("tbody"); for (o = 0, l = s.length; o < l; o++)r.appendChild(i[s[o].oldIndex].cloneNode(!0)); n.html(r.innerHTML), t = 0 == t ? 1 : 0 }), $(document).ready(function () { CalculateSavingsMiles(), $(".updatebtn").addClass("hidden"), $('input[name="HistoricalAccount"]').on("change", getCategories), $("#SelectedCategory").on("change", onCategoryChange), $("#SelectedSubCategory").on("change", getProducts); $("#SelectedCategory").val(), $("#SelectedSubCategory").val(); if (0 < $(".pods #RateCriteria").length && $("#RateCriteria a.reset").hide(), 0 < $("#calcForm").length && savCalc(), 0 < $("#FAS").length) { var e = $(".tab__target:not(.collapsed)").attr("href").split("/").slice(-1)[0]; history.replaceState({ openingMethod: e }, null, "/savings/find/results/" + e), $("#FAS input").on("focus", function () { $(this).nextAll("label").addClass("chkfocus") }), $("#FAS input").on("blur", function () { $(this).nextAll("label").removeClass("chkfocus") }), $(".jsPostback").off().on("click", function (e) { e.preventDefault(), FASupdate() }), 0 === $(".active-toggle").length && ($(".toggle").addClass("active-toggle"), $(".toggle-content").hide()) } 0 < $("#molOffline").length && $.getScript("/virgin/assets/js/app-outage.js", function () { "No" == outageData.mortgages && ($("#molOffline").show(), $("#molOnline").hide()) }), 0 < $("#bPlan").length && budgetplan(), 0 < $("#SavApp").length && ($("#SavApp input").on("focus", function () { $(this).addClass("chkfocus") }), $("#SavApp input").on("blur", function () { $(this).removeClass("chkfocus") })), radioShowHides(), hideJSToggles(), $("#apply-now .radio__trigger").on("change", function () { _gaq.push(["_trackEvent", "Savings Offline Application Method Selection", "Click", $(this).data("rel")]) }), $("#OnlineSavingsApplicationTransfer").submit(function (e) { if (this.checkValidity()) { var t = $("#producttype").val(), a = $("input[name=applicationtype]:checked").val(), n = $("#productid").val(); window.location.href = t && a && n ? "/_ets2/securegateway.asp?Product=" + t + "&CustomerType=" + a + "&ID=" + n : "/virgin/service/sign-in/?product=savings&dd=0" } e.preventDefault() }), $(".savings-apply-now-top").on("click", function () { _gaq.push(["_trackEvent", "Savings Apply Now - Top", "Click", $(".savings-product-name").clone().children().remove().end().text().trim()]) }) });